{% load staticfiles %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{% static 'font/font-awesome-4.5.0/css/font-awesome.min.css' %}" media="screen" title="no title" charset="utf-8">
        <link href="{% static 'css/vendors.css' %}" rel="stylesheet">
    {% block custom_css %}{% endblock %}
        <title>
            {% block custom_title %}{% endblock %}
        </title>
{#        {% block head %}{% endblock %}#}
    </head>
<body>
    <div class="navbar">
        <div class="nav">
            <ul>
                <li>
                    <a href="{% url 'index' %}">首页</a>
                    <span class="cursor"></span>
                </li>
                <li>
                    <a href="{% url 'topic:list' %}">专题</a>
                    <span class="cursor"></span>
                </li>
                <li>
                    <a href="{% url 'food:explore' %}">发现</a>
                    <span class="cursor"></span>
                </li>
                <li>
                    <a href="{% url 'food:list' %}">好吃</a>
                    <span class="cursor"></span>
                </li>
                <li>
                    <a href="{% url 'forum:index' %}">讨论区</a>
                    <span class="cursor"></span>
                </li>
            </ul>
            {% if request.user.is_authenticated %}
                <a href="{% url 'food:create' %}"><button type="button">分享</button></a>
                <div class="user-name">
                    <button type="button" name="user-name-btn" class="user-name-btn">{{ request.user.username }}
                        <span class="redpoint" style="display: none;"></span>
                    </button>
                    <ul class="user-dropdown">
                        <a href="{% url 'user:home' user_id=request.user.id %}"><li>资料</li></a>
                        <a id="message">
                            <li>私信 (<span id="msg-count">0</span>)</li>
                        </a>
                    </ul>
                </div>
            {% else %}
                <a href="{% url 'user:login' %}"><button type="button" name="login" id="login-btn">登录</button></a>
                <a href="{% url 'user:register' %}"><button type="button" name="register" id="register-btn">注册</button></a>
            {% endif %}
            <form method="post" action="{% url 'search:search' %}">
                {% csrf_token %}
{#                {{ search_form.q | attr:"id:search" | attr:"placeholder:寻觅好吃……"}}#}
                <input type="text" name="search" value="寻找好物……" id="search">
            </form>
        </div>
    </div>
    {% block content %}{% endblock %}
    <div class="chat-container" id="chat-container" style="display: none;">
        <div class="chat-bar">
            <span class="chat-title">私信</span>
            <a style="color:#000;" id="chat-close"><i class="fa fa-remove"></i></a>
        </div>
        <div class="chat-main">
            <div class="chat-left">
              <ul class="chat-users">
              </ul>
            </div>
            <div class="chat-right">
              <div class="chat-record"></div>
              <div class="chat-sender">
                <input type="text" name="sender" id="send-msg" placeholder="按回车发送私信">
              </div>
            </div>
        </div>
    </div>
    <script src="{% static 'js/vendors.js' %}"></script>
    <script src="{% static 'js/user_base.js' %}"></script>
    <script src="{% static 'js/js.cookie.js' %}"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="{% static 'js/csrf.js' %}"></script>
    <script src="{% static 'js/chat.js' %}"></script>
    <script type="text/javascript">
        $(function(){
            $("#private").click(function() {
                var userId = $("#follow-btn").attr('data-id');
                openChatBar(userId);
            });
            $("#follow-btn").click(function(event) {
                var that = $(this);
                var id = that.attr('data-id');
                var action = that.attr('data-action');

                $.ajax({
                    url: "{% url 'user:follow' %}",
                    method: "POST",
                    data: {
                        id: id,
                        action: action
                    }
                }).success(function(data) {
                    if(data.status == true) {
                        if (action == 'follow') {
                            that.attr('data-action', 'unfollow');
                            that.text('取消关注');
                        } else {
                            that.attr('data-action', 'follow');
                            that.text('关注');
                        }
                    }
                }).error(function(error) {
                    alert("网络异常");
                });
            });
        });
    </script>
    {% block custom_js %}{% endblock %}
</body>
</html>

